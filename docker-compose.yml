version: '3.8'

services:
  # 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (MySQL 8) ã‚µãƒ¼ãƒ“ã‚¹
  db:
    image: mysql:8.0
    container_name: mysql_db
    restart: always
    environment:
      # ğŸš¨ é–‹ç™ºç”¨è¨­å®šã§ã™ã€‚å¿…è¦ã«å¿œã˜ã¦å¤‰æ›´ã—ã¦ãã ã•ã„
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_DATABASE: my_database
      MYSQL_USER: my_user
      MYSQL_PASSWORD: user_password
    volumes:
      - db_data:/var/lib/mysql
      - .:/app 
      # ã€è¿½åŠ ã€‘ãƒ­ãƒ¼ã‚«ãƒ«ã®000-default.confã‚’ã‚³ãƒ³ãƒ†ãƒŠå†…ã«ãƒã‚¦ãƒ³ãƒˆ
      - ./000-default.conf:/etc/apache2/sites-enabled/000-default.conf 
      
    ports:
      - "3306:3306"

  # 2. PHP 8.2 + Apache Webã‚µãƒ¼ãƒãƒ¼ ã‚µãƒ¼ãƒ“ã‚¹
  app:
    image: webdevops/php-apache:8.2
    container_name: php_app
    restart: always
    volumes:
      - .:/app 
    environment:
      # Webã‚µãƒ¼ãƒãƒ¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ«ãƒ¼ãƒˆã‚’ CakePHP ã® webroot ã«è¨­å®š
      WEB_DOCUMENT_ROOT: /app/webroot 
      # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæ–‡å­—åˆ—
      DATABASE_URL: mysql://cakephp_user:user_password@db/cakephp_db
      CAKEPHP_DEBUG: 1

    ports:
      - "8080:80"
    depends_on:
      - db

volumes:
  db_data: